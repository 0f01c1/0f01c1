---
import { getCollection } from 'astro:content';
import BaseLayout from '../../layouts/BaseLayout.astro';
import PostList from '../../components/PostList.astro';
import { formatTitle } from '../../consts';

export async function getStaticPaths() {
	const posts = await getCollection('blog');
    const tags = posts.flatMap((post) => post.data.tags);
    return tags.map((tag) => ({
        params: { slug: tag },
        props: { tag, posts: posts.filter((post) => post.data?.tags?.includes(tag as string)) },
    }));
}

const {tag, posts} = Astro.props;
---

<BaseLayout 
  title={formatTitle(`#${tag as string}`)} 
  description={`Posts tagged with ${tag as string}`}
>
  <div class="w-full max-w-screen-md mx-auto flex flex-col gap-4">
      <div class="flex flex-col">
        <h1 class="text-5xl mb-2 font-bold">#{tag}</h1>
        <a href="/tags" class="text-sm text-gray-600 dark:text-neutral-400 hover:underline mt-1">
          ‚Üê All tags
        </a>
      </div>
      <div class="flex flex-col mt-4">
        <PostList posts={posts} />
      </div>
  </div>
</BaseLayout>
